/*
 * jQuery treegrid Plugin 0.2.0
 * https://github.com/maxazan/jquery-treegrid
 * 
 * Copyright 2013, Pomazan Max
 * Licensed under the MIT licenses.
 */

(function(b){var e={initTree:function(a){var c=b.extend({},this.treegrid.defaults,a);return this.each(function(){var a=b(this);a.treegrid("setTreeContainer",b(this));a.treegrid("setSettings",c);c.getRootNodes.apply(this,[b(this)]).treegrid("initNode",c)})},initNode:function(a){return this.each(function(){var c=b(this);c.treegrid("setTreeContainer",a.getTreeGridContainer.apply(this));c.treegrid("getChildNodes").treegrid("initNode",a);c.treegrid("initExpander").treegrid("initIndent").treegrid("initEvents").treegrid("initState").treegrid("initSettingsEvents")})},
initEvents:function(){var a=b(this);a.on("change",function(){var a=b(this);a.treegrid("render");a.treegrid("getSetting","saveState")&&a.treegrid("saveState")});a.on("collapse",function(){var a=b(this);a.removeClass("treegrid-expanded");a.addClass("treegrid-collapsed")});a.on("expand",function(){var a=b(this);a.removeClass("treegrid-collapsed");a.addClass("treegrid-expanded")});return a},initSettingsEvents:function(){var a=b(this);a.on("change",function(){var a=b(this);"function"===typeof a.treegrid("getSetting",
"onChange")&&a.treegrid("getSetting","onChange").apply(a)});a.on("collapse",function(){var a=b(this);"function"===typeof a.treegrid("getSetting","onCollapse")&&a.treegrid("getSetting","onCollapse").apply(a)});a.on("expand",function(){var a=b(this);"function"===typeof a.treegrid("getSetting","onExpand")&&a.treegrid("getSetting","onExpand").apply(a)});return a},initExpander:function(){var a=b(this),c=a.find("td").get(a.treegrid("getSetting","treeColumn")),d=a.treegrid("getSetting","expanderTemplate"),
e=a.treegrid("getSetting","getExpander").apply(this);e&&e.remove();b(d).prependTo(c).click(function(){b(b(this).closest("tr")).treegrid("toggle")});return a},initIndent:function(){var a=b(this);a.find(".treegrid-indent").remove();for(var c=0;c<b(this).treegrid("getDepth");c++)b(a.treegrid("getSetting","indentTemplate")).insertBefore(a.find(".treegrid-expander"));return a},initState:function(){var a=b(this);a.treegrid("getSetting","saveState")&&!a.treegrid("isFirstInit")?a.treegrid("restoreState"):
"expanded"===a.treegrid("getSetting","initialState")?a.treegrid("expand"):a.treegrid("collapse");return a},isFirstInit:function(){var a=b(this).treegrid("getTreeContainer");void 0===a.data("first_init")&&a.data("first_init",void 0===b.cookie(a.treegrid("getSetting","saveStateName")));return a.data("first_init")},saveState:function(){var a=b(this);if("cookie"===a.treegrid("getSetting","saveStateMethod")){var c=b.cookie(a.treegrid("getSetting","saveStateName"))||"",c=""===c?[]:c.split(","),d=a.treegrid("getNodeId");
a.treegrid("isExpanded")?-1===b.inArray(d,c)&&c.push(d):a.treegrid("isCollapsed")&&-1!==b.inArray(d,c)&&c.splice(b.inArray(d,c),1);b.cookie(a.treegrid("getSetting","saveStateName"),c.join(","))}return a},restoreState:function(){var a=b(this);if("cookie"===a.treegrid("getSetting","saveStateMethod")){var c=b.cookie(a.treegrid("getSetting","saveStateName")).split(",");-1!==b.inArray(a.treegrid("getNodeId"),c)?a.treegrid("expand"):a.treegrid("collapse")}return a},getSetting:function(a){return!b(this).treegrid("getTreeContainer")?
null:b(this).treegrid("getTreeContainer").data("settings")[a]},setSettings:function(a){b(this).treegrid("getTreeContainer").data("settings",a)},getTreeContainer:function(){return b(this).data("treegrid")},setTreeContainer:function(a){return b(this).data("treegrid",a)},getRootNodes:function(){return b(this).treegrid("getSetting","getRootNodes").apply(this,[b(this).treegrid("getTreeContainer")])},getAllNodes:function(){return b(this).treegrid("getSetting","getAllNodes").apply(this,[b(this).treegrid("getTreeContainer")])},
isNode:function(){return null!==b(this).treegrid("getNodeId")},getNodeId:function(){return null===b(this).treegrid("getSetting","getNodeId")?null:b(this).treegrid("getSetting","getNodeId").apply(this)},getParentNodeId:function(){return b(this).treegrid("getSetting","getParentNodeId").apply(this)},getParentNode:function(){return null===b(this).treegrid("getParentNodeId")?null:b(this).treegrid("getSetting","getNodeById").apply(this,[b(this).treegrid("getParentNodeId"),b(this).treegrid("getTreeContainer")])},
getChildNodes:function(){return b(this).treegrid("getSetting","getChildNodes").apply(this,[b(this).treegrid("getNodeId"),b(this).treegrid("getTreeContainer")])},getDepth:function(){return null===b(this).treegrid("getParentNode")?0:b(this).treegrid("getParentNode").treegrid("getDepth")+1},isRoot:function(){return 0===b(this).treegrid("getDepth")},isLeaf:function(){return 0===b(this).treegrid("getChildNodes").length},isLast:function(){if(b(this).treegrid("isNode")){var a=b(this).treegrid("getParentNode");
if(null===a){if(b(this).treegrid("getNodeId")===b(this).treegrid("getRootNodes").last().treegrid("getNodeId"))return!0}else if(b(this).treegrid("getNodeId")===a.treegrid("getChildNodes").last().treegrid("getNodeId"))return!0}return!1},isFirst:function(){if(b(this).treegrid("isNode")){var a=b(this).treegrid("getParentNode");if(null===a){if(b(this).treegrid("getNodeId")===b(this).treegrid("getRootNodes").first().treegrid("getNodeId"))return!0}else if(b(this).treegrid("getNodeId")===a.treegrid("getChildNodes").first().treegrid("getNodeId"))return!0}return!1},
isExpanded:function(){return b(this).hasClass("treegrid-expanded")},isCollapsed:function(){return b(this).hasClass("treegrid-collapsed")},isOneOfParentsCollapsed:function(){var a=b(this);return a.treegrid("isRoot")?!1:a.treegrid("getParentNode").treegrid("isCollapsed")?!0:a.treegrid("getParentNode").treegrid("isOneOfParentsCollapsed")},expand:function(){return b(this).each(function(){var a=b(this);!a.treegrid("isLeaf")&&!a.treegrid("isExpanded")&&(a.trigger("expand"),a.trigger("change"))})},expandAll:function(){var a=
b(this);a.treegrid("getRootNodes").treegrid("expandRecursive");return a},expandRecursive:function(){return b(this).each(function(){var a=b(this);a.treegrid("expand");a.treegrid("isLeaf")||a.treegrid("getChildNodes").treegrid("expandRecursive")})},collapse:function(){return b(this).each(function(){var a=b(this);!a.treegrid("isLeaf")&&!a.treegrid("isCollapsed")&&(a.trigger("collapse"),a.trigger("change"))})},collapseAll:function(){var a=b(this);a.treegrid("getRootNodes").treegrid("collapseRecursive");
return a},collapseRecursive:function(){return b(this).each(function(){var a=b(this);a.treegrid("collapse");a.treegrid("isLeaf")||a.treegrid("getChildNodes").treegrid("collapseRecursive")})},toggle:function(){var a=b(this);a.treegrid("isExpanded")?a.treegrid("collapse"):a.treegrid("expand");return a},render:function(){return b(this).each(function(){var a=b(this);a.treegrid("isOneOfParentsCollapsed")?a.hide():a.show();a.treegrid("isLeaf")||(a.treegrid("renderExpander"),a.treegrid("getChildNodes").treegrid("render"))})},
renderExpander:function(){return b(this).each(function(){var a=b(this),c=a.treegrid("getSetting","getExpander").apply(this);c?a.treegrid("isCollapsed")?(c.removeClass(a.treegrid("getSetting","expanderExpandedClass")),c.addClass(a.treegrid("getSetting","expanderCollapsedClass"))):(c.removeClass(a.treegrid("getSetting","expanderCollapsedClass")),c.addClass(a.treegrid("getSetting","expanderExpandedClass"))):(a.treegrid("initExpander"),a.treegrid("renderExpander"))})}};b.fn.treegrid=function(a){if(e[a])return e[a].apply(this,
Array.prototype.slice.call(arguments,1));if("object"===typeof a||!a)return e.initTree.apply(this,arguments);b.error("Method with name "+a+" does not exists for jQuery.treegrid")};b.fn.treegrid.defaults={initialState:"expanded",saveState:!1,saveStateMethod:"cookie",saveStateName:"tree-grid-state",expanderTemplate:'<span class="treegrid-expander"></span>',indentTemplate:'<span class="treegrid-indent"></span>',expanderExpandedClass:"treegrid-expander-expanded",expanderCollapsedClass:"treegrid-expander-collapsed",
treeColumn:0,getExpander:function(){return b(this).find(".treegrid-expander")},getNodeId:function(){var a=/treegrid-([A-Za-z0-9_-]+)/;return a.test(b(this).attr("class"))?a.exec(b(this).attr("class"))[1]:null},getParentNodeId:function(){var a=/treegrid-parent-([A-Za-z0-9_-]+)/;return a.test(b(this).attr("class"))?a.exec(b(this).attr("class"))[1]:null},getNodeById:function(a,b){return b.find("tr.treegrid-"+a)},getChildNodes:function(a,b){return b.find("tr.treegrid-parent-"+a)},getTreeGridContainer:function(){return b(this).closest("table")},
getRootNodes:function(a){a=b.grep(a.find("tr"),function(a){var a=b(a).attr("class"),d=/treegrid-parent-([A-Za-z0-9_-]+)/;return/treegrid-([A-Za-z0-9_-]+)/.test(a)&&!d.test(a)});return b(a)},getAllNodes:function(a){a=b.grep(a.find("tr"),function(a){a=b(a).attr("class");return/treegrid-([A-Za-z0-9_-]+)/.test(a)});return b(a)},onCollapse:null,onExpand:null,onChange:null}})(jQuery);
